# ğŸ§  Mission 5 â€” Backend Node.js + Prisma + JWT Auth

Projeto backend desenvolvido com **Node.js**, **Express**, **Prisma**, **JWT** e **Jest**, integrando autenticaÃ§Ã£o, middlewares, testes e estrutura de banco relacional.
Objetivo: demonstrar domÃ­nio completo de backend moderno com boas prÃ¡ticas, testes e documentaÃ§Ã£o.

---

## ğŸš€ InÃ­cio rÃ¡pido

```bash
# 1. Inicializar projeto (caso ainda nÃ£o exista)
npm init -y
```

---

## ğŸ“¦ DependÃªncias

### Principais
```bash
npm install bcrypt chalk cors dotenv express
```

### Desenvolvimento
```bash
npm install --save-dev @types/express nodemon jest supertest eslint
```

---

## ğŸ§¹ Lint e formataÃ§Ã£o

```bash
# Verificar erros de lint
npm run lint

# Corrigir automaticamente
npm run lint:fix
```

# 1ï¸âƒ£ Instala o commitlint
npm i -D @commitlint/config-conventional @commitlint/cli
bash
Copiar cÃ³digo
# 2ï¸âƒ£ Cria o arquivo de configuraÃ§Ã£o
echo "export default { extends: ['@commitlint/config-conventional'] };" > commitlint.config.js
bash
Copiar cÃ³digo
# 3ï¸âƒ£ Adiciona o hook commit-msg no Husky
npx husky add .husky/commit-msg 'npx --no-install commitlint --edit $1'

---

## ğŸ—„ï¸ Banco de Dados (Prisma + PostgreSQL)

```bash
# Instalar Prisma
npm install @prisma/client
npm install --save-dev prisma

# Inicializar Prisma
npx prisma init

# Rodar migraÃ§Ã£o inicial
npx prisma migrate dev --name init
```

---

## âš™ï¸ Scripts Ãºteis

Adicione estes scripts ao `package.json` (caso ainda nÃ£o estejam):

```json
"scripts": {
  "dev": "nodemon src/server.js",
  "test": "jest",
  "lint": "eslint .",
  "lint:fix": "eslint . --fix",
  "db:push": "prisma db push",
  "db:migrate": "prisma migrate deploy",
  "db:seed": "node prisma/seed.js",
  "start": "node src/server.js"
}
```

---

## ğŸ§ª Testes

```bash
npm test
```

Framework: **Jest + Supertest**
Inclui testes de integraÃ§Ã£o (`/auth/login`, `/auth/logout`, `/auth/register`, `/me`) e unitÃ¡rios (`signJwt`, `allowRoles`, `tokenDenylist.memory`, etc).

---

## ğŸ” Commits e histÃ³rico

```bash
# Ver commits resumidos
git log --oneline --graph --decorate
```

Exemplo de histÃ³rico:
```
* f1ae606 (HEAD -> master) DB WITH MIDDLEWARE TESTS DONE NOW
* d0488bb db tests with helpers done
* 6e7128a helpers middlewares and its tests done
* fee4bc2 db structure done
* fb66780 skeleton done
```

---

## âš™ï¸ Arquivo `.env.example`

```bash
DATABASE_URL="postgresql://user:password@localhost:5432/mission5?schema=public"
JWT_SECRET="dev-secret"
JWT_EXPIRES_IN="1d"
PORT=3000
```

---

## ğŸ§­ Estrutura do projeto (resumida)

```
middlewares/
â”œâ”€â”€ AppError.js
â”œâ”€â”€ errorHandler.js
â”œâ”€â”€ success.js
â””â”€â”€ successHandler.js

src/
â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ guards/
â”‚   â”‚   â”œâ”€â”€ allowRoles.js
â”‚   â”‚   â”œâ”€â”€ authRequired.js
â”‚   â”‚   â””â”€â”€ isSelfOrRoles.js
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ registerRoute.js
â”‚   â”‚   â”œâ”€â”€ loginRoute.js
â”‚   â”‚   â””â”€â”€ logoutRoute.js
â”‚   â””â”€â”€ tokens/
â”‚       â”œâ”€â”€ signJwt.js
â”‚       â””â”€â”€ tokenDenylist.memory.js
â”œâ”€â”€ users/
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â””â”€â”€ prisma.js
â”‚   â”œâ”€â”€ listUsersRoute.js
â”‚   â”œâ”€â”€ adminDeleteStaffRoute.js
â”‚   â”œâ”€â”€ emailCheckRoute.js
â”‚   â””â”€â”€ meRoute.js
â””â”€â”€ utils/
    â””â”€â”€ sanitize.js
```

---

## ğŸ”‘ Rotas principais (API)

| MÃ©todo | Rota | ProteÃ§Ã£o | DescriÃ§Ã£o |
|:--|:--|:--|:--|
| `POST` | `/auth/register` | pÃºblica | Cria novo usuÃ¡rio |
| `POST` | `/auth/login` | pÃºblica | Gera token JWT |
| `POST` | `/auth/logout` | autenticado | Revoga token ativo |
| `GET` | `/me` | autenticado | Retorna usuÃ¡rio logado |
| `GET` | `/users` | ADMIN | Lista usuÃ¡rios |
| `DELETE` | `/users/:id` | ADMIN ou Self | Remove usuÃ¡rio |
| `GET` | `/check-email` | pÃºblica | Verifica disponibilidade de email |

---

## ğŸ§° Stack principal

- Node.js (ESM)
- Express 5
- Prisma ORM (PostgreSQL)
- JWT Auth
- Jest + Supertest
- ESLint
- Dotenv
- Bcrypt
- CORS
- Chalk (para logs)
- Nodemon

---

## ğŸ§± Seeds

Arquivo `prisma/seed.js` cria usuÃ¡rios iniciais (ADMIN e STAFF):

```js
await prisma.user.createMany({
  data: [
    { name: 'Admin', email: 'admin@demo.com', passwordHash: bcrypt.hashSync('admin123', 10), role: 'ADMIN' },
    { name: 'Staff', email: 'staff@demo.com', passwordHash: bcrypt.hashSync('staff123', 10), role: 'STAFF' }
  ]
});
```

---

## ğŸ§© Middlewares

- `successHandler.js`: injeta `res.success(status, data)`
- `errorHandler.js`: captura `AppError` e erros Prisma (P2002 â†’ 409, P2025 â†’ 404)
- `AppError.js`: classe base de erro customizado

---

## ğŸ§± Testes automatizados

Pasta `_tests_` cobre:
- AutenticaÃ§Ã£o (`login`, `logout`, `register`, `me`)
- Guards (`authRequired`, `allowRoles`, `isSelfOrRoles`)
- Tokens (`signJwt`, `tokenDenylist.memory`)
- Middlewares (`successHandler`, `errorHandler`)
- Rotas de usuÃ¡rio (`list`, `delete`, `check-email`)
- Banco (`user.db.test.js`)

---

## ğŸ’¡ ObservaÃ§Ãµes finais

Este projeto Ã© parte da **Operation Warpath / NeuroCoding Project** (Mission 5).
Foco: demonstrar domÃ­nio de backend com autenticaÃ§Ã£o JWT, Prisma ORM e testes automatizados.

Para rodar localmente:
```bash
cp .env.example .env
npm install
npm run db:push
npm run db:seed
npm run dev
```

Servidor iniciarÃ¡ em: **http://localhost:3000**

---

**Autor:** Gabriel Bussab (Jibrail)
**Contato:** [linkedin.com/in/gabriel-bussab](https://www.linkedin.com/in/gabriel-bussab)
**PropÃ³sito:** DemonstraÃ§Ã£o tÃ©cnica para freelas e provas prÃ¡ticas.
**Status:** ğŸ§© Quase pronto (falta `/me` e ajustes menores antes do deploy final)
