# ğŸ§  Mission 5 â€” Backend Node.js + Prisma + JWT Auth

Projeto backend desenvolvido com **Node.js**, **Express**, **Prisma**, **JWT** e **Jest**, integrando autenticaÃ§Ã£o, middlewares, testes e estrutura de banco relacional.
Objetivo: demonstrar domÃ­nio completo de backend moderno com boas prÃ¡ticas, testes e documentaÃ§Ã£o.

---

## ğŸš€ InÃ­cio rÃ¡pido
```bash
# 1. Inicializar projeto (caso ainda nÃ£o exista)
npm init -y
```

---

## ğŸ“¦ DependÃªncias

### Principais

```bash
npm install bcrypt chalk cors dotenv express
```

### Desenvolvimento
```bash
npm install --save-dev @types/express nodemon jest supertest eslint
```

---

## ğŸ§¹ Lint e formataÃ§Ã£o
```bash
# Verificar erros de lint
npm run lint
# Corrigir automaticamente
npm run lint:fix
```

# 1ï¸âƒ£ Instala o commitlint
npm i -D @commitlint/config-conventional @commitlint/cli
bash
Copiar cÃ³digo

# 2ï¸âƒ£ Cria o arquivo de configuraÃ§Ã£o
echo "export default { extends: ['@commitlint/config-conventional'] };" > commitlint.config.js
bash
Copiar cÃ³digo

# 3ï¸âƒ£ Adiciona o hook commit-msg no Husky
npx husky add .husky/commit-msg 'npx --no-install commitlint --edit $1'

---

## ğŸ—„ï¸ Banco de Dados (Prisma + PostgreSQL)
```bash
# Instalar Prisma
npm install @prisma/client
npm install --save-dev prisma

# Inicializar Prisma
npx prisma init

# Rodar migraÃ§Ã£o inicial
npx prisma migrate dev --name init
```

---

## âš™ï¸ Scripts Ãºteis
Adicione estes scripts ao `package.json` (caso ainda nÃ£o estejam):

```json
"scripts": {
  "dev": "nodemon src/server.js",
  "test": "jest",
  "lint": "eslint .",
  "lint:fix": "eslint . --fix",
  "db:push": "prisma db push",
  "db:migrate": "prisma migrate deploy",
  "db:seed": "node prisma/seed.js",
  "start": "node src/server.js"
}
```

---

## ğŸ§ª Testes
```bash
npm test

Teste especifico:
npm test -- -t "success function"
npm test -- _tests_/middlewares/successHandler.test.js
```

Framework: **Jest + Supertest**
Inclui testes de integraÃ§Ã£o (`/auth/login`, `/auth/logout`, `/auth/register`, `/me`) e unitÃ¡rios (`signJwt`, `allowRoles`, `tokenDenylist.memory`, etc).

---

## ğŸ” Commits e histÃ³rico
```bash
# Ver commits resumidos
git log --oneline --graph --decorate
```

Exemplo de histÃ³rico:

```
* f1ae606 (HEAD -> master) DB WITH MIDDLEWARE TESTS DONE NOW
* d0488bb db tests with helpers done
* 6e7128a helpers middlewares and its tests done
* fee4bc2 db structure done
* fb66780 skeleton done
```

---

## âš™ï¸ Arquivo `.env.example`

```bash
DATABASE_URL="postgresql://user:password@localhost:5432/mission5?schema=public"
JWT_SECRET="dev-secret"
JWT_EXPIRES_IN="1d"
PORT=3000
```

---

	## ESTRUTURA DO PROJETO
	1ï¸âƒ£ FundaÃ§Ã£o do Projeto
			README - package.json - .gitignore
	2ï¸âƒ£ Ambiente e Config SensÃ­veis
			.env - .env.test
	3ï¸âƒ£ Pipeline de Qualidade e SemÃ¢ntica
			.editorconfig - estlint.config - .eslintignore - .pretter - pre-commit - commit-msg - husky.sh - commitlint.config.js - logger.js - spyConsole.js
	4ï¸âƒ£ Banco de Dados (Prisma)
			schema.prisma - MIGRATIONS/init - seed.js - prisma.js
	5ï¸âƒ£ Middleware Helpers (success/error/AppError)
			success.js - successHandler.js - success.Handler.test.js - AppError.js - errorHandler.js - errorHandler.test.js
	6ï¸âƒ£ ConfiguraÃ§Ã£o Global e Testes
			jest.config.cjs - jest.setup.env.cjs - globalSetup.cjs
	7ï¸âƒ£ Testes de Integridade de Banco
			user.db.test.js - app.bridge.userToDb.js - bridge.http.test.js
	8ï¸âƒ£ JWT Core (signJwt / verifyJwt)
			signJwt.js - signJtw.test.js - verifyJtw.js - verifyJtw.test.js
	9ï¸âƒ£ JWT Denylist (RevogaÃ§Ã£o)
			tokenDenyList.memory.js - tokenDenyList.memory.test.js
	ğŸ”Ÿ JWT Guards
			authRequired.js - authRequired.test.js - allowRoles.js - allowRoles.test.js -  isSelfOrRoles.js - isSelforRoles.test.js
  1ï¸âƒ£1ï¸âƒ£ JWT Auth Routes (register / login / logout / me)
	1ï¸âƒ£2ï¸âƒ£ Rotas de auth: register, login, logout, me (+ testes HTTP) e RBAC nas Rotas de UsuÃ¡rio
	13 - SERVIDOR/POSTMAN


	13ï¸âƒ£ Admin Seed & Invariantes
	14ï¸âƒ£ SeguranÃ§a Aplicativa (Hardening)
	15ï¸âƒ£ Smoke E2E de AutenticaÃ§Ã£o
	16ï¸âƒ£ DX & Pipeline de Qualidade (Husky, lint, commit)
	17ï¸âƒ£ Empacotamento & ExecuÃ§Ã£o (scripts, env.example, README)
	18ï¸âƒ£ DocumentaÃ§Ã£o de Rotas (README / Postman)
	19ï¸âƒ£ Observabilidade & Logs (logger / spyConsole)
	20ï¸âƒ£ Servidor (app.js + server.js, listen e shutdown)

## ğŸ§­ Estrutura do projeto (resumida)
```
middlewares/
â”œâ”€â”€ AppError.js
â”œâ”€â”€ errorHandler.js
â”œâ”€â”€ success.js
â””â”€â”€ successHandler.js

src/
â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ guards/
â”‚   â”‚   â”œâ”€â”€ allowRoles.js
â”‚   â”‚   â”œâ”€â”€ authRequired.js
â”‚   â”‚   â””â”€â”€ isSelfOrRoles.js
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ registerRoute.js
â”‚   â”‚   â”œâ”€â”€ loginRoute.js
â”‚   â”‚   â””â”€â”€ logoutRoute.js
â”‚   â””â”€â”€ tokens/
â”‚       â”œâ”€â”€ signJwt.js
â”‚       â””â”€â”€ tokenDenylist.memory.js
â”œâ”€â”€ users/
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â””â”€â”€ prisma.js
â”‚   â”œâ”€â”€ listUsersRoute.js
â”‚   â”œâ”€â”€ adminDeleteStaffRoute.js
â”‚   â”œâ”€â”€ emailCheckRoute.js
â”‚   â””â”€â”€ meRoute.js
â””â”€â”€ utils/
    â””â”€â”€ sanitize.js
```

---

## COMANDO TREE:
tree -I 'node_modules|.git|dist|build' -a

## ğŸ”‘ Rotas principais (API)

| MÃ©todo   | Rota             | ProteÃ§Ã£o      | DescriÃ§Ã£o                         |
| :------- | :--------------- | :------------ | :-------------------------------- |
| `POST`   | `/auth/register` | pÃºblica       | Cria novo usuÃ¡rio                 |
| `POST`   | `/auth/login`    | pÃºblica       | Gera token JWT                    |
| `POST`   | `/auth/logout`   | autenticado   | Revoga token ativo                |
| `GET`    | `/me`            | autenticado   | Retorna usuÃ¡rio logado            |
| `GET`    | `/users`         | ADMIN         | Lista usuÃ¡rios                    |
| `DELETE` | `/users/:id`     | ADMIN ou Self | Remove usuÃ¡rio                    |
| `GET`    | `/check-email`   | pÃºblica       | Verifica disponibilidade de email |

---

## ğŸ§° Stack principal
- Node.js (ESM)
- Express 5
- Prisma ORM (PostgreSQL)
- JWT Auth
- Jest + Supertest
- ESLint
- Dotenv
- Bcrypt
- CORS
- Chalk (para logs)
- Nodemon

---

## ğŸ§± Seeds
Arquivo `prisma/seed.js` cria usuÃ¡rios iniciais (ADMIN e STAFF):

```js
await prisma.user.createMany({
	data: [
		{ name: 'Admin', email: 'admin@demo.com', passwordHash: bcrypt.hashSync('admin123', 10), role: 'ADMIN' },
		{ name: 'Staff', email: 'staff@demo.com', passwordHash: bcrypt.hashSync('staff123', 10), role: 'STAFF' },
	],
});
```

---

## ğŸ§© Middlewares
- `successHandler.js`: injeta `res.success(status, data)`
- `errorHandler.js`: captura `AppError` e erros Prisma (P2002 â†’ 409, P2025 â†’ 404)
- `AppError.js`: classe base de erro customizado

---

## ğŸ§± Testes automatizados

Pasta `_tests_` cobre:

- AutenticaÃ§Ã£o (`login`, `logout`, `register`, `me`)
- Guards (`authRequired`, `allowRoles`, `isSelfOrRoles`)
- Tokens (`signJwt`, `tokenDenylist.memory`)
- Middlewares (`successHandler`, `errorHandler`)
- Rotas de usuÃ¡rio (`list`, `delete`, `check-email`)
- Banco (`user.db.test.js`)

---

## ğŸ’¡ ObservaÃ§Ãµes finais

Este projeto Ã© parte da **Operation Warpath / NeuroCoding Project** (Mission 5).
Foco: demonstrar domÃ­nio de backend com autenticaÃ§Ã£o JWT, Prisma ORM e testes automatizados.

Para rodar localmente:

```bash
cp .env.example .env
npm install
npm run db:push
npm run db:seed
npm run dev
```

Servidor iniciarÃ¡ em: **http://localhost:3000**

---

**Autor:** Gabriel Bussab (Jibrail)
**Contato:** [linkedin.com/in/gabriel-bussab](https://www.linkedin.com/in/gabriel-bussab)
**PropÃ³sito:** DemonstraÃ§Ã£o tÃ©cnica para freelas e provas prÃ¡ticas.
**Status:** ğŸ§© Quase pronto (falta `/me` e ajustes menores antes do deploy final)
